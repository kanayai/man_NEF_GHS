{
  "hash": "b369e2ef7bd27f33da7bd0de710eb7ef",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: On the natural exponential family generated by the generalised hyperbolic secant distribution\nauthors:\n  - name: Karim AI\n    affiliation: University of Bath\n    roles: writing\n    corresponding: true\nbibliography: references.bib\n---\n\n# Intro\n\nThis vignette serves two purposes\n\n* Introduced the missing GLM distribution\n* review of GLMs and extensions in `R`\n\n# Preliminaries\n\n\nA continuous real random variable $Z$ is said to follow a _generalised hyperbolic secant distribution_ (GHS) [@Harkness_GHS] with parameter $\\lambda>0$ if the corresponding  probability  density function can be written as:\n\n$$\ng(z|\\lambda)\n=\n\\frac{2^{\\lambda-2}\\,\\Gamma\\left(\\frac{\\lambda}{2}+i\\frac{z}{2}\\right)\\Gamma\\left(\\frac{\\lambda}{2}-i\\frac{z}{2}\\right)}{\\pi\\,\\Gamma(\\lambda)}\\,,\\quad z \\in {\\mathcal R}\\,,\n$$\n\nwhere $\\Gamma(w)$ is the [Gamma function ](https://en.wikipedia.org/wiki/Gamma_function) in the complex plane, that is\n\n$$\n\\Gamma(w)=\\int_{0}^\\infty t^{w-1}\\exp(-t)dt\\,,\\qquad Re(w)>0\\,.\n$$\n\nThe name of the distribution comes from the case $\\lambda=1$, e.g.\n\n$$\ng(z|1)\n=\n\\frac{\\Gamma\\left(\\frac{1}{2}+i\\frac{z}{2}\\right)\\Gamma\\left(\\frac{1}{2}-i\\frac{z}{2}\\right)}{2\\pi\\Gamma(1)}\n=\\frac{\\pi}{2\\pi\\,\\cosh(\\pi\\,z/2)}=\\frac{1}{2}\\textrm{sech}\\left(\\frac{\\pi\\,z}{2}\\right)\n$$\n\nwhich can be obtained by using identity 6.1.30 in @abramowitz_stegun.  \n\n\n\nUsing the properties of the complex Gamma function (Section 6.1 in @abramowitz_stegun) we can write the log densities as follows:\n\n$$\n\\log g(z|\\lambda)\n=\n(\\lambda-2)\\log(2)-\\log(\\pi)-\\log \\Gamma(\\lambda)+\n2\\,Re\\left(\\log \\Gamma\\left(\\frac{\\lambda}{2}+i\\frac{z}{2}\\right)\\right)\n$$\nTo compute $g(z|\\lambda)$ we only need a function to evaluate the log of the Gamma function in the complex plane and here we use the `gls` package (@gsl_package) to do so.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gsl)\ndghs  <- function(z,lambda,log=F){\n  logf  <- (lambda-2)*log(2) - log(pi) - \n    lgamma(lambda) + 2*Re(lngamma_complex((lambda+z*1i)/2))\n  if (log){\n    res <- logf\n  }else{\n    res <- exp(logf) \n  }\n  res\n}\n```\n:::\n\n\n\n\n::: {#cell-fig-dens-ghs .cell}\n\n```{.r .cell-code .hidden}\nN_grid <- 1000\nz_grid <- seq(-5,5,length=N_grid)\nf1 <- dghs(z_grid,lambda=1,log=F)\nf2 <- dghs(z_grid,lambda=2,log=F)\nf4 <- dghs(z_grid,lambda=4,log=F)\nf8 <- dghs(z_grid,lambda=8,log=F)\nplot(z_grid,f1,type=\"l\",\n     xlab=\"z\", \n     ylab=\"density\")\nlines(z_grid,f2,lty=2)\nlines(z_grid,f4,lty=3)\nlines(z_grid,f8,lty=4)\nabline(v=0,col=\"grey\",lwd=0.5)\nlegend(\"topright\",lty=c(1,2,3,4),legend=c(expression(lambda == 1),\n                                          expression(lambda == 2),\n                                          expression(lambda == 4),\n                                          expression(lambda == 8)))\n```\n\n::: {.cell-output-display}\n![Generalised hyperbolic secant densities](index_files/figure-jats/fig-dens-ghs-1.png){#fig-dens-ghs}\n:::\n:::\n\n\n\nThe densities $g(z|\\lambda)$  are  symmetric about zero (see @fig-dens-ghs) with exponentially decaying tails. \n\n\nThe moment generating function of the GHS distribution is well defined and is given by:\n\n\\begin{aligned}\nE[\\exp(\\theta\\,Z)]&=\\frac{2^{\\lambda-2}}{\\pi\\Gamma(\\lambda)}\\int_{-\\infty}^\\infty \\exp(\\theta \\,z)\\,\\Gamma\\left(\\frac{\\lambda}{2}+i\\frac{z}{2}\\right)\\Gamma\\left(\\frac{\\lambda}{2}-i\\frac{z}{2}\\right)dz\\\\\n\\rule{0in}{3ex}&=\\sec^\\lambda(\\theta)<\\infty\\,,\\qquad |\\theta|<\\frac{\\pi}{2}\\,.\n\\end{aligned}\n\nThe above implies the GHS distribution is infinitely divisible so that the probability distribution of independent sums of GHS distributions\nis also a GHS distribution. Then any GHS distribution with  integer $\\lambda$ can be reproduced by convolutions of the basic density with $\\lambda=1$.\n\nThe distribution has zero mean and the parameter $\\lambda$ that equals the variance. \n\n\n\\begin{aligned}\nE[Z]\n&=\\left.\\frac{d}{d\\theta}\\sec^{\\lambda}(\\theta)\\right|_{\\theta=0}\n=\\left.\\lambda \\tan(\\theta) \\sec^{\\lambda}(\\theta)\\right|_{\\theta=0}=0\\\\\nVar[Z]\n&=\\left.\\frac{d^2}{d\\theta^2}\\sec^{\\lambda}(\\theta)\\right|_{\\theta=0}=\n\\left.\n\\lambda(1+(1+\\lambda) \\tan^2(\\theta))\\sec^{\\lambda}(\\theta)\\right|_{\\theta=0} =\\lambda\n\\end{aligned}\n\n\nIn this way, the\n_standard_ distribution is $g(z|1)$.\nThe natural exponential family (NEF) generated by the GHS distribution has therefore densities of the form:\n\n$$\n\\tilde{f}_Z(z|\\theta,\\lambda)=\\exp(\\theta\\,z-\\lambda\\log(\\sec(\\theta)))\\,g(z|\\lambda)\n\\,,\\qquad |\\theta|<\\frac{\\pi}{2}\\,.\n$$\n\nBy making the transformation $Y=Z/\\lambda$  we obtain the so-called _exponential family_ form (see @McCullagh_Nelder_1989)\n\n$$\n\\tilde{f}_Y(y|\\theta,\\lambda)=\\lambda\\,\\tilde{f}_Z(\\lambda\\,y|\\theta,\\lambda)=\n\\lambda\\,g(\\lambda\\,y|\\lambda)\\,\n\\exp\\left(\\frac{\\theta\\,y-\\psi(\\theta)}{1/\\lambda}\\right)\n$${#eq-nef-ghs-dens1}\n\nwhere $\\psi(\\theta)=\\log(\\sec(\\theta))$. This is a _reproductive exponential dispersion model_ in the language of @jorgensen_1997 and $\\phi=1/\\lambda$ is the so-called dispersion parameter. Clearly, if $\\lambda$  is unknown then  $\\tilde{f}_Y(y|\\theta,\\lambda)$  is not a two-dimensional exponential family. \n\nWe will follow @morris_1982_1 and call the family $\\tilde{f}_Y(y|\\theta,\\lambda)$ the NEF-GHS. The mean and variance of the NEF-GHS are given by:\n\n\\begin{aligned}\nE[Y]&=\\psi'(\\theta)=\\tan(\\theta)=\\mu\\\\\n Var[Y]&=\\frac{1}{\\lambda}\\psi''(\\theta)=\\frac{1}{\\lambda}\\sec^2(\\theta)=\\frac{1}{\\lambda}(1+\\tan^2(\\theta))=\\frac{1}{\\lambda}(1+\\mu^2)\n\\end{aligned}\n\n\n\n\nWe can reparametrise in terms of the mean $\\mu$ and the dispersion parameter $\\phi=1/\\lambda$ as follows\n\n$$\nf(y|\\mu,\\phi)=\\tilde{f}(y|\\arctan(\\mu),1/\\phi)=\n\\frac{1}{\\psi}\\,g(y/\\psi|1/\\psi)\\,\n\\exp\\left(\\lambda\\left[y\\,\\arctan(\\mu)-\\frac{1}{2}\\log(1+\\mu^2)\\right]\\right)\n$$\n\n\nForm the above we obtain that  $g(\\mu)=\\arctan(\\mu)$ is the corresponding canonical link of the family.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n   my_family <- list(\n       family   = \"my_family\",\n       link     = \"arctan\",  \n       linkfun  = function(mu)atan(mu), # canonical link function\n       linkinv  = function(eta)tan(eta), # inverse link function\n       variance = function(mu) 1+mu^2,\n       mu.eta   = function(eta) sec(eta)^2, # Derivative of mean wrt eta\n       dev.resids = function(y, mu,wt){2*wt*y(atan(y)-atan(mu))+log((1+mu^2)/(1+y^2))}, # Deviance residuals\n       aic = function(y, mu, weights, data) 1, # AIC\n       validmu = function(mu) is.finite(mu) , # Valid mu\n       valideta = function(eta) abs(eta)<pi/2\n   )\n   class(my_family) <- \"family\"\n```\n:::\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n nef_ghs<-gaussian()\n\n\nnef_ghs$family = \"nef ghs\"\nnef_ghs$link     = \"arctan\"\nnef_ghs$linkfun  = function(mu)atan(mu) # canonical link function\nnef_ghs$linkinv  = function(eta)tan(eta) # inverse link function\nnef_ghs$variance = function(mu) 1+mu^2\nnef_ghs$mu.eta   = function(eta) sec(eta)^2 # Derivative of mean wrt eta\nnef_ghs$dev.resids = function(y, mu,wt){2*wt*y(atan(y)-atan(mu))+log((1+mu^2)/(1+y^2))} # Deviance residuals\nnef_ghs$aic = function(y, mu, weights, data) 1 # AIC\nnef_ghs$validmu = function(mu) is.finite(mu)  # Valid mu\nnef_ghs$valideta = function(eta) abs(eta)<pi/2\nnef_ghs$dispersion = 1\n\nstr(nef_ghs)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nList of 12\n $ family    : chr \"nef ghs\"\n $ link      : chr \"arctan\"\n $ linkfun   :function (mu)  \n $ linkinv   :function (eta)  \n $ variance  :function (mu)  \n $ dev.resids:function (y, mu, wt)  \n $ aic       :function (y, mu, weights, data)  \n $ mu.eta    :function (eta)  \n $ initialize:  expression({  n <- rep.int(1, nobs)  if (is.null(etastart) && is.null(start) && is.null(mustart) && ((family$link| __truncated__\n $ validmu   :function (mu)  \n $ valideta  :function (eta)  \n $ dispersion: num 1\n - attr(*, \"class\")= chr \"family\"\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\ny1<-rnorm(100,4,1)\ny2<-rnorm(100,6,1)\ny<-c(y1,y2)\nx<-c(rep(0,100),rep(1,100))\ndf <-data.frame(x=x,y=y)\n\nlin_mod<-lm( y ~ x, data = df)\n\nsummary(lin_mod)$coeff\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n            Estimate Std. Error  t value     Pr(>|t|)\n(Intercept) 4.075987  0.1017522 40.05796 6.499994e-97\nx           1.996470  0.1438994 13.87407 5.069413e-31\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#clon_lin_mod<-   glm( y ~ x, data = df, family = nef_ghs)\n\n#summary(clon_lin_mod)$coeff\n```\n:::\n\n\n\n# Parameter interpretation\n\nall in MOrris the mean measures symmetry with limits $\\mu=0$ is symmetric and $|\\mu|\\to \\infty$ is a gamma, see also page 103 of Jorgensen\n\n$\\lambda \\to \\infty$ also converges to normal\n\nwhen $\\mu=0$ the distribution is symmeytric and  tails are exponential \n\nfor postive $\\theta$ the riight tail is the same as an specific gamma (Morris end of section 5)\n\n# likelihood inference\n\n\n$$\n\\ell(\\beta,\\phi)\n$$\n",
    "supporting": [
      "index_files/figure-jats"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}